import{system as ba}from"@minecraft/server";import{world as ke}from"@minecraft/server";var re=class{constructor(e,a){this.identifier=e,this.rootType=a,this.entityTypes=[]}compile(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||this.rootType=="vector"?e:JSON.stringify(e)}unCompile(e){if(e!=null)return["boolean","number","string","vector"].includes(this.rootType)?e:JSON.parse(e)}registerEntityTypes(e){return this.entityTypes=this.entityTypes.concat(e),this}setWorldDynamic(e=!0){return this.isWorldDynamic=e,this}get(e){try{if(e)return this.unCompile(e.getDynamicProperty(this.identifier));if(!this.isWorldDynamic)throw new Error(`${this.identifier} Is not World Dynamic!`);return this.unCompile(ke.getDynamicProperty(this.identifier))}catch{return}}set(e,a){let r=this.compile(e);if(a){let o=a.typeId;if(!this.entityTypes.find(i=>i.id==o))throw new Error(`${a.id} Is not a registered entity type for ${this.identifier}!`);a.setDynamicProperty(this.identifier,r)}else{if(!this.isWorldDynamic)throw new Error(`${this.identifier} Is not World Dynamic!`);ke.setDynamicProperty(this.identifier,r)}}remove(e){if(e){let a=e.typeId;if(!this.entityTypes.find(r=>r.id==a))throw new Error(`${e.id} Is not a registered entity type for ${this.identifier}!`);return e.setDynamicProperty(this.identifier,void 0)}else{if(!this.isWorldDynamic)throw new Error(`${this.identifier} Is not World Dynamic!`);return ke.setDynamicProperty(this.identifier,void 0)}}};import{system as Ht,world as Vt}from"@minecraft/server";var b="-";import{world as zt}from"@minecraft/server";import{world as Ve}from"@minecraft/server";var h=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[];let a=Ve.getDynamicProperty(`db_${this.tableName}`)??"{}";if(typeof a!="string")throw"Database Set with Unknown Value!";let r=JSON.parse(a);this.MEMORY=r,this.onLoadCallback?.(r),this.QUEUE.forEach(o=>o())}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(e)})}async saveData(){this.MEMORY||await this.addQueueTask(),Ve.setDynamicProperty(`db_${this.tableName}`,JSON.stringify(this.MEMORY))}async onLoad(e){if(this.MEMORY)return e(this.MEMORY);this.onLoadCallback=e}async set(e,a){if(!this.MEMORY)throw new Error("Data tried to be set before load!");return this.MEMORY[e]=a,this.saveData()}get(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return this.MEMORY?this.get(e):(await this.addQueueTask(),this.MEMORY?this.MEMORY[e]:null)}keys(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){return this.MEMORY?this.keys():(await this.addQueueTask(),this.MEMORY?Object.keys(this.MEMORY):[])}values(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){return this.MEMORY?this.values():(await this.addQueueTask(),this.MEMORY?Object.values(this.MEMORY):[])}has(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `hasSync` instead!");return Boolean(this.MEMORY[e])}async hasSync(e){return this.MEMORY?this.has(e):(await this.addQueueTask(),this.MEMORY?Boolean(this.MEMORY[e]):!1)}collection(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return this.MEMORY?this.collection():(await this.addQueueTask(),this.MEMORY?this.MEMORY:{})}async delete(e){if(!this.MEMORY)return!1;let a=delete this.MEMORY[e];return await this.saveData(),a}async clear(){return this.MEMORY={},await this.saveData()}getKeyByValue(e){for(let a in this.MEMORY)if(this.MEMORY[a]===e)return a;return null}};var n={config:new h("config"),freezes:new h("freezes"),mutes:new h("mutes"),bans:new h("bans"),regions:new h("regions"),roles:new h("roles"),tasks:new h("tasks"),npcs:new h("npcs"),ids:new h("ids"),logs:new h("logs"),protections:new h("protections")};function Ye(t){return[...zt.getPlayers()].find(e=>e.name===t)}var L=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},Y=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:Boolean(e&&e!=""),value:e}}fail(e){return"Value must be of type string!"}},A=class{constructor(e="integer",a){this.name=e;this.typeName="int";this.name=e,this.range=a}static isNumberInRange(e,a){return e>=a[0]&&e<=a[1]}matches(e){return{success:this.range?A.isNumberInRange(parseInt(e),this.range):!isNaN(Number(e)),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},fe=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},F=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},J=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},Ce=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!Ye(e),value:Ye(e)}}fail(e){return`player: "${e}", is not in this world`}},we=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},j=class{constructor(e="array",a){this.name=e;this.types=a;this.typeName="string";this.name=e,this.types=a,this.typeName=a.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Pe=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},Be=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!n.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},S={string:Y,int:A,float:fe,location:F,boolean:J,player:Ce,target:we,array:j,duration:Pe,playerName:Be};var oe=class{constructor(e){this.data=e;this.data=e,this.sender=e.sender}};function Je(t,e){let a=t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g);return a?a.map(r=>r.replace(/"(.+)"/,"$1").toString()):[]}function je(t,e){t.sendMessage({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function xe(t,e){t.sendMessage({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function Ue(t,e,a,r,o){if(t.sendMessage({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${b}${e.data.name} ${r.slice(0,o).join(" ")}`,r[o]??" ",r.slice(o+1).join(" ")]}]}),a.children.length>1||!r[o]){let i=a.children.map(s=>s.type instanceof L?s.type.name:s.type?.typeName);t.sendMessage(`\xA7c"${r[o]??"undefined"}" is not valid! Argument "${[...new Set(a.children.map(s=>s?.type?.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.sendMessage(`\xA7c${a.children[0]?.type?.fail(r[o])}`)}function Nt([t,e,a],r){if(!t||!e||!t)return null;let o=r.getViewDirection(),i=[r.location.x,r.location.y,r.location.z],s=[o.x,o.y,o.z],c=[t,e,a].map(u=>{let g=parseFloat(u);return isNaN(g)?0:g}),p=[t,e,a].map((u,g)=>u.includes("~")?c[g]+i[g]:u.includes("^")?c[g]+s[g]:c[g]);return{x:p[0],y:p[1],z:p[2]}}function qe(t,e,a,r){let o=e[e.length-1]??r,i=[];for(let[s,c]of e.entries())if(!c?.type?.name.endsWith("*")){if(c.type instanceof F){i.push(Nt([t[s],t[s+1],t[s+2]],a.sender));continue}c.type instanceof L||i.push(c?.type?.matches(t[s]).value??t[s])}o.callback(new oe(a),...i)}import{world as $t}from"@minecraft/server";var C=class{constructor(){this.data=new Map,$t.afterEvents.playerLeave.subscribe(e=>{this.data.delete(e.playerId)})}set(e,a){this.data.set(e.id,a)}get(e){return this.data.get(e.id)}has(e){return this.data.has(e.id)}delete(e){this.data.delete(e.id)}clear(){this.data.clear()}playerIds(){return[...this.data.keys()]}includes(e){return this.playerIds().includes(e.id)}};var v=[],Ke=new C;Vt.beforeEvents.chatSend.subscribe(t=>{if(!t.message.startsWith(b))return;t.cancel=!0;let e=Je(t.message,b),a=v.find(c=>c.depth==0&&(c.data.name==e[0]||c.data?.aliases?.includes(e[0]))),r={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.getTargets()};if(!a)return je(t.sender,e[0]);if(!a.data?.requires?.(t.sender))return xe(r.sender,a);if(a.data?.cooldown){let c=Ke.get(t.sender)??{};if(Object.keys(c).length==0)c[a.data.name]=Date.now(),Ke.set(t.sender,c);else if(Date.now()-c[a.data.name]<a.data.cooldown){let p=Math.abs(Math.ceil((Date.now()-(c[a.data.name]+a.data.cooldown))/1e3));return t.sender.sendMessage({translate:"commands.default.cooldown",with:[a.data.name,p.toString()]})}}e.shift();let o=[],i=(c,p)=>{if(c.children.length>0){let u=c.children.find(g=>g.type?.matches(e[p]).success);return!u&&!e[p]&&c.callback?void 0:u?u.data?.requires?.(r.sender)?(o.push(u),i(u,p+1)):(xe(r.sender,u),"fail"):(Ue(r.sender,a,c,e,p),"fail")}};i(a,0)!="fail"&&Ht.run(()=>{qe(e,o,r,a)})});var k={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,a="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${a??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,a)=>`- "${t}" Because: ${e}, Expiry ${a}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,a)=>`- "${t}" Because: ${e}, Expiry: ${a}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var m=class{constructor(e,a,r=0,o){this.data=e;this.type=a;this.depth=r;this.parent=o;e.requires||(e.requires=()=>!0),this.data=e,this.type=a??new L(this.data.name),this.children=[],this.depth=r,this.parent=o,this.callback=null,v.push(this)}argument(e){let a=new m(this.data,e,this.depth+1,this);return this.children.push(a),a}string(e){return this.argument(new Y(e))}int(e,a){return this.argument(new A(e,a))}array(e,a){return this.argument(new j(e,a))}boolean(e){return this.argument(new J(e))}location(e){let a=this.argument(new F(e));return e.endsWith("*")?a:a.location(e+"_y*").location(e+"_z*")}literal(e){let a=new m(e,new L(e.name),this.depth+1,this);return this.children.push(a),a}executes(e){return this.callback=e,this}};import{FormCancelationReason as ne,MessageFormData as Yt}from"@minecraft/server-ui";var N=class{constructor(e,a){this.title=e,this.body=a,this.form=new Yt,e&&this.form.title(e),a&&this.form.body(a),this.triedToShow=0}setButton1(e,a){return this.button1={text:e,callback:a},this.form.button1(e),this}setButton2(e,a){return this.button2={text:e,callback:a},this.form.button2(e),this}show(e,a){this.triedToShow=0,this.form.show(e).then(r=>{if(r.canceled){if(r.cancelationReason==ne.UserBusy){if(this.triedToShow>200)return e.sendMessage({translate:"forms.actionForm.show.timeout"});this.triedToShow++,this.show(e,a)}r.cancelationReason==ne.UserClosed&&a?.();return}r.selection==0&&this.button1?.callback?.(),r.selection==1&&this.button2?.callback?.()})}forceShow(e,a){this.form.show(e).then(r=>{if(r.canceled){r.cancelationReason==ne.UserBusy&&this.forceShow(e,a),r.cancelationReason==ne.UserClosed&&a?.();return}r.selection==0&&this.button1?.callback?.(),r.selection==1&&this.button2?.callback?.()})}};function B(t,e,a,r=()=>{}){new N("Confirm To Continue",e).setButton1("Confirm",a).setButton2("Never Mind",r).show(t,r)}import{GameMode as xr,MinecraftDimensionTypes as $,Player as Jt,system as Dr,Vector as rt,world as f}from"@minecraft/server";var Qe={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},Xe=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Ze=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var q=[],Ie=!1,Te=-64,Me=320,_=class{static getAllRegions(){if(Ie)return q;let e=n.regions.values().map(a=>new _(a.from,a.to,a.dimensionId,a.permissions,a.key));return e.forEach(a=>{q.push(a)}),Ie=!0,e}static vectorInRegion(e,a){return this.getAllRegions().find(r=>r.dimensionId==a&&De(e,{x:r.from.x,y:Te,z:r.from.z},{x:r.to.x,y:Me,z:r.to.z}))}static async removeRegionAtPosition(e,a){let r=this.vectorInRegion(e,a);return r?n.regions.delete(r.key):!1}constructor(e,a,r,o,i){this.from=e,this.to=a,this.dimensionId=r,this.permissions=o??Qe,this.key=i||Date.now().toString(),i||this.update().then(()=>{K("minecraft:deny"),q.push(this)})}async update(){return n.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){return K("minecraft:bedrock"),q=q.filter(e=>e.key!=this.key),n.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&De(e.location,{x:this.from.x,y:Te,z:this.from.z},{x:this.to.x,y:Me,z:this.to.z})}changePermission(e,a){this.permissions[e]=a,this.update()}};var E=class{static getTasks(){return n.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return E.getTasks().find(r=>r.playerName==e)?.role}constructor(e,a){let r=E.getTasks();r.push({playerName:e,role:a}),n.tasks.set("changePlayerRole",r)}};var ie="https://discord.gg/dMa3A5UYKX",br=["minecraft:beehive","minecraft:bee_nest","minecraft:axolotl_bucket","minecraft:cod_bucket","minecraft:tadpole_bucket","minecraft:tropical_fish_bucket","minecraft:salmon_bucket","minecraft:pufferfish_bucket"],tt=["minecraft:allow","minecraft:barrier","minecraft:border_block","minecraft:deBug_stick","minecraft:deny","minecraft:jigsaw","minecraft:light_block","minecraft:command_block","minecraft:repeating_command_block","minecraft:chain_command_block","minecraft:command_block_minecart","minecraft:structure_block","minecraft:structure_void","minecraft:bedrock","minecraft:end_portal_frame","minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_Block","minecraft:movingBlock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingoBsidian","minecraft:invisiBle_Bedrock","minecraft:invisiBleBedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],hr=["minecraft:dispenser"],at=["minecraft:bedrock","minecraft:barrier","minecraft:invisible_bedrock","minecraft:moving_block"],kr=["minecraft:chest","minecraft:trapped_chest","minecraft:barrel","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:lit_furnace","minecraft:blast_furnace","minecraft:lit_blast_furnace","minecraft:smoker","minecraft:lit_smoker","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box"];var se={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var ve={overworld:f.getDimension($.overworld),nether:f.getDimension($.nether),theEnd:f.getDimension($.theEnd),"minecraft:overworld":f.getDimension($.overworld),"minecraft:nether":f.getDimension($.nether),"minecraft:the_end":f.getDimension($.theEnd)};var ot={y:317098e-16,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1};function Q(t){let e=t.split(","),a=0;for(let r of e){let o=parseInt(r.match(/\d+/)[0]),i=r.match(/[a-zA-Z]+/)[0];if(!ot[i])throw new Error(`Invalid duration unit: ${i}`);a+=ot[i]*o}return a}function w(t){let e=new Date().getTime(),a=t-e,r=Math.abs(a),o=1e3,i=60*o,s=60*i,c=24*s,p=Math.floor(r/c),u=Math.floor(r%c/s),g=Math.floor(r%s/i),ae=Math.floor(r%i/o);return a>=0?p>0?`in ${p} day${p>1?"s":""}`:u>0?`in ${u} hour${u>1?"s":""}`:g>0?`in ${g} minute${g>1?"s":""}`:`in ${ae} second${ae>1?"s":""}`:p>0?`${p} day${p>1?"s":""} ago`:u>0?`${u} hour${u>1?"s":""} ago`:g>0?`${g} minute${g>1?"s":""} ago`:`${ae} second${ae>1?"s":""} ago`}function jt(t,e){return[t.x,e.x]=[Math.min(t.x,e.x),Math.max(t.x,e.x)],[t.y,e.y]=[Math.min(t.y,e.y),Math.max(t.y,e.y)],[t.z,e.z]=[Math.min(t.z,e.z),Math.max(t.z,e.z)],[t,e]}function De(t,e,a){let[r,o]=jt(e,a),{x:i,y:s,z:c}=t;return i>=r.x&&i<=o.x&&s>=r.y&&s<=o.y&&c>=r.z&&c<=o.z}function R(t,e=[],a){if(X(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.sendMessage("You have been tried to kick, but you cant!"),a?.();try{t.runCommandAsync(`kick "${t.name}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(r){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(r))return;a&&a()}}function d(t){return t instanceof Jt?n.roles.get(t.name)??"member":n.roles.get(t)??"member"}function H(t,e){if(typeof t=="string"){n.roles.set(t,e);let a=[...f.getPlayers()].find(r=>r.name==t);a?a.setDynamicProperty("role",e):new E(t,e)}else n.roles.set(t.name,e),t.setDynamicProperty("role",e)}function X(t){return f.getDynamicProperty("worldsOwner")==t.id}function Ee(){let t=f.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function nt(){let t=Ee();if(!t)return null;let e=n.ids.collection();return Object.keys(e).find(a=>e[a]===t)}function Z(t){if(!t)return f.setDynamicProperty("worldsOwner","");f.setDynamicProperty("worldsOwner",t.id.toString())}function le(){return f.getDynamicProperty("isLockDown")??!1}function We(t){f.setDynamicProperty("isLockDown",t)}function Ut(t,e,a=1){if(a<=0||a>1)throw new Error("Step size must be between 0 (exclusive) and 1 (inclusive).");let r=[];for(let o=0;o<=1;o+=a){let i=t.x+o*(e.x-t.x),s=t.y+o*(e.y-t.y),c=t.z+o*(e.z-t.z);r.push({x:i,y:s,z:c})}return r}function K(t){for(let e of _.getAllRegions()){let a=new rt(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),r=new rt(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let o of Ut(a,r)){let i=ve[e.dimensionId].getBlock(o);!i||i.setType(t)}}}function x(t){switch(t){case"banned_items":return n.config.get("banned_items")??tt;case"banned_blocks":return n.config.get("banned_blocks")??at;case"enchantments":return n.config.get("enchantments")??se;case"appealLink":return n.config.get("appealLink")??ie}}function O(t,e){n.config.set(t,e)}import{Player as st}from"@minecraft/server";var l=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),n.logs.set(Date.now().toString(),e)}};function it(t,e,a,r="No Reason",o="Rubedo Auto Mod"){let i=t instanceof st?t.name:t,s={key:e,playerName:i,date:Date.now(),duration:a?Q(a):null,expire:a?Q(a)+Date.now():null,reason:r,by:o};n.bans.set(e,s),new l({message:`${i}'s Ban was set by: ${s.by}, to expire: ${w(s.expire)}, because: ${s.reason}.`,playerName:i})}var y=class{constructor(e,a,r="No Reason",o="Rubedo Auto Mod"){e instanceof st?it(e,e.id,a,r,o):it(e,n.ids.get(e),a,r,o)}};function Le(t,e,a,r,o){if(n.bans.get(n.ids.get(e)))return t.sender.sendMessage(`\xA7c${e} is already banned`);t.sender.sendMessage("\xA7aClose chat to confirm"),B(t.sender,`Are you sure you want to ban ${e}, for ${a??"forever"}`,()=>{new y(e,a,r,t.sender.name),t.sender.sendMessage(k["modules.commands.ban.reply"](e,a,r))})}var Re=new m({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(d(t))});Re.literal({name:"add",description:"Bans a player"}).argument(new S.playerName).executes((t,e)=>{Le(t,e,null,null,t.sender.name)}).argument(new S.duration("duration")).executes((t,e,a)=>{Le(t,e,a,null,t.sender.name)}).string("reason").executes((t,e,a,r)=>{Le(t,e,a,r,t.sender.name)});Re.literal({name:"remove",description:"un-bans a player"}).argument(new S.playerName("playerName")).executes((t,e)=>{let a=n.bans.values().find(r=>r.playerName==e);if(!a)return t.sender.sendMessage(`${e} is not banned`);n.bans.delete(a.key)?(t.sender.sendMessage(`\xA7a${e}\xA7r has been Unbanned!`),new l({message:`${e} was Un-Banned by ${t.sender}.`,playerName:e})):t.sender.sendMessage(`\xA7cFailed to un-ban ${e}`)});Re.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=n.bans.values();if(e.length==0)return t.sender.sendMessage("\xA7cNo one is banned!");t.sender.sendMessage(`\xA72--- Showing Bans (${e.length}) ---`);for(let a of e)t.sender.sendMessage(k["commands.ban.list.player"](a.playerName,a.reason,a.expire?w(a.duration):"Forever"))});var V=new m({name:"database",description:"Manages database",requires:t=>t.isOp()});V.literal({name:"reload",description:"Re-Grabs database data",requires:t=>t.isOp()}).executes(t=>{t.sender.sendMessage("Reloaded Database data!")});V.literal({name:"reset",description:"Resets all database data!",requires:t=>t.isOp()}).executes(t=>{t.sender.sendMessage("\xA7aClose chat to confirm Reset of database."),B(t.sender,"Are you sure you want to reset all Database Data! This cannot be undone.",()=>{Object.values(n).forEach(e=>e.clear()),t.sender.sendMessage("Reset All Database data!"),new l({message:`${t.sender.name}'s Reset all Database data!`,playerName:t.sender.name})})});V.literal({name:"resetTable",description:"Resets a given table!",requires:t=>t.isOp()}).array("table",Object.keys(n)).executes((t,e)=>{B(t.sender,`Are you sure you want to reset all Database Data from table: ${e}! This cannot be undone.`,()=>{n[e].clear(),t.sender.sendMessage("Reset All Database data!"),new l({message:`${t.sender.name}'s Reset all Database data on table: ${e}`,playerName:t.sender.name})})});V.literal({name:"collection",description:"Grabs a collection from a given table!",requires:t=>t.isOp()}).array("table",Object.keys(n)).executes((t,e)=>{let a=n[e].collection();t.sender.sendMessage(JSON.stringify(a))});V.literal({name:"get",description:"Gets the value of a key on a given table.",requires:t=>t.isOp()}).array("table",Object.keys(n)).string("key").executes((t,e,a)=>{let r=n[e].get(a);t.sender.sendMessage(`Value for key: ${a}, on table: ${e}, is ${r}`)});V.literal({name:"tableIds",description:"Returns a list of all the tableIds",requires:t=>t.isOp()}).executes(t=>{t.sender.sendMessage(`\xA7aCurrent Table Ids:\xA7r
- ${Object.keys(n).join(`
- `)}`)});new m({name:"ecwipe",description:"Clears a players ender chest",requires:t=>d(t)=="admin"}).argument(new S.player("player")).executes((t,e)=>{for(let a=0;a<27;a++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${a} air`);t.sender.sendMessage(`\xA7aCleared "${e.name}"'s Ender chest!`),new l({message:`${t.sender.name}'s wiped ${e.name}'s Ender Chest!`,playerName:e.name})});var ce=class{constructor(e,a="No Reason"){let r=e.location,o={playerName:e.name,key:e.id,reason:a,location:{x:r.x,y:r.y,z:r.z,dimension:e.dimension.id}};n.freezes.set(e.id,o)}};import{world as qt}from"@minecraft/server";var ye=new m({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(d(t))});ye.literal({name:"add",description:"Freezes a player"}).argument(new S.player("player")).string("reason").executes((t,e,a)=>{new ce(e,a),t.sender.sendMessage(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${a}" \xA7aSuccessfully`),e.sendMessage(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${a}"`),e.runCommand("inputpermission set @s movement disabled"),new l({message:`${t.sender.name}'s Froze: ${e.name}. Because: ${a}.`,playerName:e.name})});ye.literal({name:"remove",description:"unfreezes a player"}).argument(new S.playerName("playerName")).executes((t,e)=>{let a=n.freezes.values().find(o=>o.playerName==e);if(!a)return t.sender.sendMessage(`${e} is not frozen`);n.freezes.delete(a.key);let r=qt.getAllPlayers().find(o=>o.name==e);r&&r.runCommand("inputpermission set @s movement enabled"),t.sender.sendMessage(`\xA7a${e}\xA7r has been UnFrozen!`),new l({message:`${t.sender.name}'s Un-Froze: ${e}.`,playerName:e})});ye.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=n.freezes.values();if(e.length==0)return t.sender.sendMessage("\xA7cNo one is frozen!");t.sender.sendMessage(`\xA72--- Showing Freezes (${e.length}) ---`);for(let a of e)t.sender.sendMessage(k["commands.freeze.list.player"](a.playerName,a.reason))});var Ge=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(v.find(a=>a.depth==0&&a.data.name==e)),value:e}}fail(e){return`${e} should be a command name!`}};function Kt(t,e,a){a.sendMessage(`${b}${t.data.name} ${e.map(r=>r.type?r.type.typeName=="literal"?r.data.name:`<${r.type.name}: ${r.type.typeName}>`:null).filter(r=>r).join(" ")}`)}function de(t,e,a,r){if(!!e.data?.requires?.(r)&&(e.callback&&Kt(t,e.depth==0?a:a.concat(e),r),e.children.length>0))for(let o of e.children)de(t,o,e.depth==0?a:a.concat(e),r)}function lt(t,e,a){t.sendMessage({rawtext:[{text:`\xA72--- Showing help page ${e} of ${a} (${b}help <page: int>) ---`}]})}function ct(t){let e=v.filter(a=>a.depth==0&&a.data?.requires?.(t));return e.length==0?0:Math.ceil(e.length/5)}var dt=new m({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=ct(t.sender),a=v.filter(r=>r.depth==0&&(r.data?.requires?.(t.sender)??!1)).slice(1*5-5,1*5);lt(t.sender,1,e);for(let r of a)de(r,r,[],t.sender)});dt.int("page").executes((t,e)=>{let a=ct(t.sender);e>a&&(e=a);let r=v.filter(o=>o.depth==0&&o.data?.requires?.(t.sender)).slice(e*5-5,e*5);lt(t.sender,e,a);for(let o of r)de(o,o,[],t.sender)});dt.argument(new Ge("command")).executes((t,e)=>{let a=v.filter(r=>r.depth==0&&r.data.name==e)[0];de(a,a,[],t.sender)});import{world as mt}from"@minecraft/server";new m({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>d(t)=="admin"}).executes(t=>{le()?(We(!1),t.sender.sendMessage("\xA7aUnlocked the server!"),new l({message:`${t.sender.name}'s Unlocked the server.`,playerName:t.sender.name})):(t.sender.sendMessage("\xA7aClose chat to confirm lockdown"),B(t.sender,k["commands.lockdown.confirm"],()=>{We(!0);for(let e of mt.getPlayers())d(e)!="admin"&&R(e,k["lockdown.kick.message"]());mt.sendMessage("\xA7l\xA7cServer is now LOCKED!"),new l({message:`${t.sender.name}'s Locked the server down.`,playerName:t.sender.name})}))});var D=class{static getMuteData(e){return n.mutes.get(e.name)}constructor(e,a,r="No Reason",o="Rubedo Auto Mod"){let i=a?Q(a):null,s={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:r,by:o};n.mutes.set(e.name,s)}};var Ae=new m({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(d(t))});Ae.literal({name:"add",description:"Mutes a player"}).argument(new S.player("player")).argument(new S.duration("duration")).string("reason").executes((t,e,a,r)=>{new D(e,a,r,t.sender.name),t.sender.sendMessage(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${a} Because: "${r}" \xA7aSuccessfully`),e.sendMessage(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${a} Because: "${r}"`),new l({message:`${t.sender.name}'s Muted: ${e.name}. Because: ${r}.`,playerName:e.name})});Ae.literal({name:"remove",description:"un-mutes a player"}).argument(new S.playerName("playerName")).executes((t,e)=>{let a=n.mutes.values().find(r=>r.playerName==e);if(!a)return t.sender.sendMessage(`${e} is not muted!`);n.mutes.delete(a.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{console.warn("[Warning]: Command '-mute' Cannot fully proceed because command 'ability' does not exist! Please enable Education Edition!")}t.sender.sendMessage(`\xA7a${e}\xA7r has been UnMuted!`),new l({message:`${t.sender.name}'s Un-Muted: ${e}.`,playerName:e})});Ae.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=n.mutes.values();if(e.length==0)return t.sender.sendMessage("\xA7cNo one is muted!");t.sender.sendMessage(`\xA72--- Showing Mutes (${e.length}) ---`);for(let a of e)t.sender.sendMessage(k["commands.mutes.list.player"](a.playerName,a.reason,a.expire?w(a.expire):"Forever"))});var me=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:Se.find(a=>a==e.location)?!0:!!n.npcs.keys().find(a=>e.id==a)}constructor(e,a){Se.push(e);let r=a.spawnEntity("minecraft:npc",e),o={dimension:r.dimension.id,x:r.location.x,y:r.location.y,z:r.location.z};n.npcs.set(r.id,o),St()}};new m({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>d(t)=="admin"}).executes(t=>{new me(t.sender.location,t.sender.dimension),t.sender.sendMessage("Spawned a verified npc at your current location"),new l({message:`${t.sender.name}'s Created a new NPC at location: ${JSON.stringify(t.sender.location)} in Dimension: ${t.sender.dimension.id}.`,playerName:t.sender.name})});import{system as _t}from"@minecraft/server";async function Qt(){let t=Date.now(),e=0;return new Promise(a=>{let r=_t.runTimeout(()=>{Date.now()-t<1e3?e++:(_t.clearRun(r),a(e))})})}new m({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(async t=>{let e=await Qt();t.sender.sendMessage(`\xA7aCurrent Ticks Per Second: ${e>18?"\xA7f{ \xA7aGood":e>13?"\xA7f{ \xA7eOk":"\xA7f{ \xA7cSevere"} ${e} \xA7f}`)});var I=new m({name:"region",description:"Create a Region",requires:t=>d(t)=="admin"});I.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,a,r,o)=>{new _({x:e,z:a},{x:r,z:o},t.sender.dimension.id),t.sender.sendMessage(`Created Region From ${e} -64 ${a} ${r} 320 ${o}`),new l({message:`${t.sender.name}'s Created a new Region from [(${e}, ${r}), (${r}, ${o})] in dimension: ${t.sender.dimension.id}.`,playerName:t.sender.name})});I.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{_.removeRegionAtPosition(t.sender.location,t.sender.dimension.id)?(t.sender.sendMessage(`Removed Region at ${JSON.stringify(t.sender.location)}`),new l({message:`${t.sender.name}'s Removed a Region at ${JSON.stringify(t.sender.location)} in dimension: ${t.sender.dimension.id}.`,playerName:t.sender.name})):t.sender.sendMessage(`Failed to find/remove region at ${JSON.stringify(t.sender.location)}`)});I.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{_.getAllRegions().forEach(e=>e.delete()),t.sender.sendMessage("Removed All regions")});I.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=_.getAllRegions();for(let a of e)t.sender.sendMessage(`Region from ${a.from.x}, ${a.from.z} to ${a.to.x}, ${a.to.z} in dimension ${a.dimensionId}`);if(e.length==0)return t.sender.sendMessage("No regions have been made yet")});var Fe=I.literal({name:"permission",description:"Handles permissions for regions"});Fe.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,a)=>{let r=_.vectorInRegion(t.sender.location,t.sender.dimension.id);if(!r)return t.sender.sendMessage("You are not in a region");r.changePermission(e,a),t.sender.sendMessage(`Changed permission ${e} to ${a}`)});Fe.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=_.vectorInRegion(t.sender.location,t.sender.dimension.id);if(!e)return t.sender.sendMessage("You are not in a region");t.sender.sendMessage(`Current region permissions ${JSON.stringify(e.permissions)}`)});var pt=Fe.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});pt.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let a=_.vectorInRegion(t.sender.location,t.sender.dimension.id);if(!a)return t.sender.sendMessage("You are not in a region");let r=a.permissions.allowedEntities;r.push(e),a.changePermission("allowedEntities",r),t.sender.sendMessage(`Added entity ${e} to the allowed entities of the region your currently standing in`)});pt.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let a=_.vectorInRegion(t.sender.location,t.sender.dimension.id);if(!a)return t.sender.sendMessage("You are not in a region");let r=a.permissions.allowedEntities;if(!r.includes(e))return t.sender.sendMessage(`The entity ${e} is not allowed to enter the region`);r=r.filter(o=>o!=e),a.changePermission("allowedEntities",r),t.sender.sendMessage(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var Oe=(o=>(o[o.member=0]="member",o[o.admin=1]="admin",o[o.moderator=2]="moderator",o[o.builder=3]="builder",o))(Oe||{});var Xt=t=>isNaN(Number(t))===!1;function Zt(t){return Object.keys(t).filter(Xt).map(e=>t[e])}var ze=new m({name:"role",description:"Changes the role for a player",requires:t=>d(t)=="admin"||X(t)});ze.literal({name:"set",description:"Sets the role for a player"}).argument(new S.playerName("playerName")).argument(new S.array("role",Zt(Oe))).executes((t,e,a)=>{H(e,a),t.sender.sendMessage(`Changed role of ${e} to ${a}`),new l({message:`${t.sender.name} Updated ${e}'s role to: ${a}.`,playerName:e})});ze.literal({name:"get",description:"Gets the role of a player"}).argument(new S.playerName("playerName")).executes((t,e)=>{let a=d(e);t.sender.sendMessage(`${e} has role: ${a}`)});var Ne=ze.literal({name:"owner",description:"Manages the owner"});Ne.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=Ee(),a=n.ids.collection(),r=Object.keys(a).find(o=>a[o]===e);t.sender.sendMessage(`\xA7aServer Owner: ${r} (id: ${e})`)});Ne.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>X(t)}).argument(new S.player).executes((t,e)=>{B(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{Z(e),t.sender.sendMessage(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`),new l({message:`${t.sender.name} Transferred server ownership to ${e.name}.`,playerName:e.name})}),t.sender.sendMessage("\xA7aClose chat to confirm")});Ne.literal({name:"clear",description:"clear's the owner of the world",requires:t=>X(t)}).executes(t=>{B(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{Z(null),t.sender.sendMessage('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!'),new l({message:`${t.sender.name} Cleared the servers ownership.`,playerName:t.sender.name})}),t.sender.sendMessage("\xA7aClose chat to confirm")});import{FormCancelationReason as _e,ModalFormData as ut}from"@minecraft/server-ui";var T=class{constructor(e,a,r,o){this.form=e,this.player=a,this.callback=r,this.formValues=o}error(e){new N("Error",e).setButton1("Return to form",()=>{let a=this.form.args;this.form.clearForm();for(let[r,o]of a.entries())switch(o.type){case"dropdown":this.form.addDropdown(o.label,o.options,this.formValues[r]);break;case"slider":this.form.addSlider(o.label,o.minimumValue,o.maximumValue,o.valueStep,this.formValues[r]);break;case"textField":this.form.addTextField(o.label,o.placeholderText,this.formValues[r]);break;case"toggle":this.form.addToggle(o.label,this.formValues[r]);default:break}this.form.show(this.player,this.callback)}).setButton2("Cancel").show(this.player)}};var P=class{constructor(e){this.title=e,this.form=new ut,e&&this.form.title(e),this.args=[]}clearForm(){this.form=new ut,this.args=[]}addDropdown(e,a,r){return this.args.push({type:"dropdown",options:a}),this.form.dropdown(e,a,r),this}addSlider(e,a,r,o,i){return this.args.push({type:"slider",label:e,minimumValue:a,maximumValue:r,valueStep:o}),this.form.slider(e,a,r,o,i),this}addToggle(e,a){return this.args.push({type:"toggle",label:e}),this.form.toggle(e,a),this}addTextField(e,a,r){return this.args.push({type:"textField",label:e,placeholderText:a}),this.form.textField(e,a,r),this}show(e,a,r){this.triedToShow=0,this.form.show(e).then(o=>{if(o.canceled){if(o.cancelationReason==_e.UserBusy){if(this.triedToShow>200)return e.sendMessage({translate:"forms.actionForm.show.timeout"});this.triedToShow++,this.show(e,a,r)}o.cancelationReason==_e.UserClosed&&r?.();return}!o.formValues||a(new T(this,e,a,o.formValues),...o.formValues.map((i,s)=>this.args[s].type=="dropdown"?this.args[s].options?.[i]:i))})}forceShow(e,a,r){this.form.show(e).then(o=>{if(o.canceled){o.cancelationReason==_e.UserBusy&&this.forceShow(e,a,r),o.cancelationReason==_e.UserClosed&&r?.();return}!o.formValues||a(new T(this,e,a,o.formValues),...o.formValues.map((i,s)=>this.args[s].type=="dropdown"?this.args[s].options?.[i]:i))})}};import{ActionFormData as It,FormCancelationReason as pe}from"@minecraft/server-ui";var W=class{constructor(e,a){this.title=e,this.body=a,this.form=new It,e&&this.form.title(e),a&&this.form.body(a),this.buttons=[],this.triedToShow=0}addButton(e,a,r,o){return this.buttons.push({text:e,iconPath:a,callback:r}),typeof e=="string"?e=(o?" ":"")+e:e.text=(o?" ":"")+e.text,this.form.button(e,a),this}show(e,a){this.triedToShow=0,this.form.show(e).then(r=>{if(r.canceled){if(r.cancelationReason==pe.UserBusy){if(this.triedToShow>200)return e.sendMessage({translate:"forms.actionForm.show.timeout"});this.triedToShow++,this.show(e,a)}r.cancelationReason==pe.UserClosed&&a?.();return}r.selection!=null&&this.buttons[r.selection].callback?.()})}forceShow(e,a){this.form.show(e).then(r=>{if(r.canceled){r.cancelationReason==pe.UserBusy&&this.forceShow(e,a),r.cancelationReason==pe.UserClosed&&a?.();return}r.selection!=null&&this.buttons[r.selection].callback?.()})}};function gt(t){new W("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{Tt(t)}).addButton("Ban an item",null,()=>{Mt(t)}).show(t)}function Tt(t){new P("Remove Banned Items").addDropdown("Select item to remove",x("banned_items")).show(t,(e,a)=>{let r=x("banned_items");r=r.filter(o=>o!=a),O("banned_items",r),t.sendMessage(`Removed Banned item "${a}"`),new l({message:`${t.name} unbanned the item: ${a}.`,playerName:t.name})})}function Mt(t){new P("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,a)=>{let r=x("banned_items");if(r.includes(a))return e.error(`\xA7cItem "${a}" is already banned`);r.push(a),O("banned_items",r),t.sendMessage(`Banned the item "${a}"`),new l({message:`${t.name} banned the item: ${a}.`,playerName:t.name})})}function bt(t){new W("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{ea(t)}).addButton("Ban an block",null,()=>{ta(t)}).show(t)}function ea(t){new P("Remove Banned Block").addDropdown("Select block to remove",x("banned_blocks")).show(t,(e,a)=>{let r=x("banned_blocks");r=r.filter(o=>o!=a),O("banned_blocks",r),t.sendMessage(`Removed Banned block "${a}"`),new l({message:`${t.name} unbanned the block: ${a}.`,playerName:t.name})})}function ta(t){new P("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,a)=>{let r=x("banned_blocks");if(r.includes(a))return e.error(`\xA7cBlock "${a}" is already banned`);r.push(a),O("banned_blocks",r),t.sendMessage(`Banned the block "${a}"`),new l({message:`${t.name} banned the block: ${a}.`,playerName:t.name})})}function ht(t){new P("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(se),0).addTextField("Level (number)","5").show(t,(e,a,r)=>{if(isNaN(r))return e.error(`\xA7c"${r}" is not a number, please enter a value like, "3", "9", etc.`);let o=parseInt(r),i=x("enchantments");i[a]=o,O("enchantments",i),t.sendMessage(`Set max level for ${a} to ${o}`),new l({message:`${t.name} set max enchant level for ${a} to ${o}.`,playerName:t.name})})}function kt(t){new P("Manage Appeal Link").addTextField("Appeal Link",ie).show(t,(e,a)=>{O("appealLink",a),t.sendMessage(`Changed the servers appeal link to ${a}`),new l({message:`${t.name} changed server appeal link to: ${a}.`,playerName:t.name})})}var M={};n.protections.onLoad(()=>{for(let t of Object.values(M))!t.getConfig().enabled||t.enable()});function ft(t){let e=new W("Manage Protections");for(let a of Object.values(M))e.addButton(a.name,a.iconPath,()=>{ra(a,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{ue(t)}).show(t)}function ra(t,e){let a=t.getConfig(),r=new P(`Manage ${t.name} Protection Config`).addToggle("Enabled",a.enabled),o=[];for(let[i,s]of Object.entries(t.configDefault))o.push(i),typeof s.defaultValue=="boolean"?r.addToggle(s.description,a[i]):typeof s.defaultValue=="number"?r.addSlider(s.description,0,100,1,a[i]):r.addTextField(s.description,null,a[i]);r.show(e,(i,s,...c)=>{s!=a.enabled&&(s&&t.enable(),s||t.disable());let p={enabled:s};for(let[u,g]of Object.keys(t.configDefault).entries())p[g]=c[u];t.setConfig(p),e.sendMessage(`Updated config for ${t.name}!`),new l({message:`${e.name} updated config for protection: ${t.name}.`,playerName:e.name})})}function ue(t){new W("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{ft(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{gt(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{bt(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{ht(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{kt(t)}).show(t)}new m({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(d(t))}).executes(t=>{ue(t.sender),t.sender.sendMessage("\xA7aForm request sent, close chat to continue!")});import{world as Ct}from"@minecraft/server";function wt(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;Ct.sendMessage({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;Ct.sendMessage({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new m({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>d(t)=="admin"}).executes(t=>{wt(t.sender,!1),new l({message:`${t.sender.name} vanished.`,playerName:t.sender.name})}).boolean("say").executes((t,e)=>{wt(t.sender,e),new l({message:`${t.sender.name} vanished, hidden: ${e}.`,playerName:t.sender.name})});var Pt="3.0.0-beta";new m({name:"version",description:"Get Current Rubedo Version",aliases:["v"]}).executes(t=>{t.sender.sendMessage(`Current Rubedo Version: ${Pt}`)});new m({name:"kick",description:"Kicks a player from the game",requires:t=>d(t)=="admin"}).argument(new S.player).string("reason").executes((t,e,a)=>{R(e,[a]),t.sender.sendMessage(`\xA7aKicked ${e.name} from the world`),new l({message:`${t.sender.name}'s Kicked: ${e.name} from the world. Because: ${a}.`,playerName:e.name})});var ee=new m({name:"log",description:"Manages the log command",requires:t=>d(t)=="admin"});ee.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new l({message:e}),t.sender.sendMessage(`\xA7aAdded new log: ${e}`)});ee.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,a)=>{let r=Object.entries(n.logs.collection()).sort((i,s)=>a=="ascending"?parseInt(s[0])-parseInt(i[0]):parseInt(i[0])-parseInt(s[0]));if(r.length==0)return t.sender.sendMessage("\xA7cNo Logs have been made!");let o=Math.ceil(r.length/8);e>o&&(e=o),t.sender.sendMessage(`\xA72--- Showing logs page ${e} of ${o} (${b}log getAll <page: int>) ---`);for(let[i,s]of r.slice(e*8-8,e*8))t.sender.sendMessage(`${w(parseInt(i))}: ${s.message}`)});ee.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new S.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,a,r)=>{let o=Object.entries(n.logs.collection()).filter(s=>s[1].playerName==e).sort((s,c)=>r=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(o.length==0)return t.sender.sendMessage(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(o.length/8);a>i&&(a=i),t.sender.sendMessage(`\xA72--- Showing logs for "${e}" page ${a} of ${i} ---`);for(let[s,c]of o.slice(a*8-8,a*8))t.sender.sendMessage(`${w(parseInt(s))}: ${c.message}`)});ee.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,a,r)=>{let o=Object.entries(n.logs.collection()).filter(s=>s[1].protection==e).sort((s,c)=>r=="ascending"?parseInt(c[0])-parseInt(s[0]):parseInt(s[0])-parseInt(c[0]));if(o.length==0)return t.sender.sendMessage(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(o.length/8);a>i&&(a=i),t.sender.sendMessage(`\xA72--- Showing logs for Protection: "${e}" page ${a} of ${i} ---`);for(let[s,c]of o.slice(a*8-8,a*8))t.sender.sendMessage(`${w(parseInt(s))}: ${c.message}`)});ee.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{n.logs.clear(),t.sender.sendMessage("\xA7aCleared All logs!"),new l({message:`${t.sender.name}'s Cleared all server logs.`,playerName:t.sender.name})});import{Player as na,world as Bt}from"@minecraft/server";var ia=Bt.afterEvents.dataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof na)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=nt();if(e)return t.entity.playSound("note.bass"),t.entity.sendMessage(`\xA7cFailed to give server owner: "${e}" is already owner!`),Bt.beforeEvents.dataDrivenEntityTriggerEvent.unsubscribe(ia);H(t.entity,"admin"),Z(t.entity),t.entity.runCommandAsync("camera @s fade time 1 1 1"),t.entity.sendMessage('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{world as sa}from"@minecraft/server";sa.afterEvents.playerSpawn.subscribe(({player:t})=>{n.ids.onLoad(()=>{if(le()&&d(t)!="admin")return R(t,k["lockdown.kick.message"]());D.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),n.ids.has(t.name)||(n.ids.set(t.name,t.id),new l({message:`New Player: ${t.name}, Joined the World.`,playerName:t.name}));let e=E.getPlayersRoleToSet(t.name);e&&H(t,e)})});import{world as la}from"@minecraft/server";la.afterEvents.playerSpawn.subscribe(t=>{n.ids.onLoad(()=>{let{player:e}=t,a=n.bans.get(e.id);if(!!a){if(a.expire&&a.expire<Date.now())return n.bans.delete(e.id);R(e,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${a.reason}`,`\xA7fExpiry: \xA7b${a.expire?w(a.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${x("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),n.bans.delete(e.id)}),new l({message:`Banned Player: ${e.name} tried to join the world during his ban duration.`,playerName:e.name})}})});import{world as ca}from"@minecraft/server";var $e={};ca.beforeEvents.chatSend.subscribe(t=>{if(!t.message.startsWith(b))for(let e of Object.values($e))e.callback(t)});var ge=class{static subscribe(e){let a=Date.now();return $e[a]={callback:e},a}static unsubscribe(e){delete $e[e]}};ge.subscribe(t=>{let e=D.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return n.mutes.delete(t.sender.name);t.cancel=!0,t.sender.sendMessage(k["modules.managers.mute.isMuted"]()),new l({message:`${t.sender.name} tried to send a message while muted: ${t.message}`,playerName:t.sender.name})}});import{system as he,world as te}from"@minecraft/server";import{system as He,world as da}from"@minecraft/server";var be={};He.runInterval(()=>{let t=[...da.getPlayers()],e=t.entries();for(let[a,r]of e){let o=Object.values(be);for(let i of o)i.delay!=0&&He.currentTick-i.lastCall<i.delay||(i.callback(r),a==t.length-1&&(i.lastCall=He.currentTick))}});var z=class{static subscribe(e,a=0){let r=Object.keys(be).length;return be[r]={callback:e,delay:a,lastCall:0},r}static unsubscribe(e){delete be[e]}};he.runTimeout(()=>{K("minecraft:deny")},6e3);te.beforeEvents.playerInteractWithBlock.subscribe(t=>{if(["moderator","admin"].includes(d(t.player))||t.player.isOp())return;let e=_.vectorInRegion(t.block.location,t.block.dimension.id);!e||Xe.includes(t.block.typeId)&&e.permissions.doorsAndSwitches||Ze.includes(t.block.typeId)&&e.permissions.openContainers||(t.cancel=!0)});te.beforeEvents.playerPlaceBlock.subscribe(t=>{["moderator","admin"].includes(d(t.player))||t.player.isOp()||!_.vectorInRegion(t.block.location,t.block.dimension.id)||(t.cancel=!0,he.run(()=>{t.player.playSound("note.bass"),t.player.sendMessage({translate:"events.claimManager.interact.invalidPermission"})}))});te.beforeEvents.playerBreakBlock.subscribe(t=>{["moderator","admin"].includes(d(t.player))||t.player.isOp()||!_.vectorInRegion(t.block.location,t.block.dimension.id)||(t.cancel=!0,he.run(()=>{t.player.playSound("note.bass"),t.player.sendMessage({translate:"events.claimManager.interact.invalidPermission"})}))});te.beforeEvents.explosion.subscribe(t=>{let e=t.getImpactedBlocks(),a=[];for(let r of e)_.vectorInRegion(r.location,t.dimension.id)||a.push(r);t.setImpactedBlocks(a)});te.afterEvents.entitySpawn.subscribe(async({entity:t})=>{let e=_.vectorInRegion(t.location,t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||t.remove()});n.regions.onLoad(()=>{he.runInterval(async()=>{for(let t of _.getAllRegions()){let e=ve[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities});for(let a of e)!t.entityInRegion(a)||a.remove()}},100),z.subscribe(t=>{for(let e of _.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5)});import{GameMode as ma,world as Sa}from"@minecraft/server";import{system as xt,world as Dt}from"@minecraft/server";var G=class{constructor(e,a,r,o){this.name=e;this.description=a;this.iconPath=r;this.isEnabledByDefault=o;this.name=e,this.description=a,this.iconPath=r,this.configDefault={},this.isEnabled=!1,this.isEnabledByDefault=o,this.events={},this.schedules=[],this.forEachPlayers=[],M[this.name]=this}setConfigDefault(e){return this.configDefault=e,n.protections.hasSync(this.name).then(a=>{if(a)return;let r={enabled:!0};for(let o of Object.keys(e))r[o]=e[o].defaultValue;n.protections.set(this.name,r)}),this}getConfig(){let e=n.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){return n.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[a,r]of Object.entries(this.events)){if(r.triggered)continue;let o=Dt.beforeEvents[a].subscribe(r.callback);r.triggered=!0,r.callback=o}for(let a of this.forEachPlayers){if(a.key)continue;let r=z.subscribe(a.callback,a.delay);a.key=r}for(let a of this.schedules){if(a.runScheduleId)continue;let r=xt.runInterval(a.callback);a.runScheduleId=r}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[a,r]of Object.entries(this.events))!r.triggered||(Dt.events[a].unsubscribe(r.callback),r.triggered=!1);for(let a of this.forEachPlayers)!a.key||(z.unsubscribe(a.key),a.key=null);for(let a of this.schedules)!a.runScheduleId||(xt.clearRun(a.runScheduleId),a.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,a){return this.events[e]={callback:a,triggered:!1},this}runSchedule(e,a){return this.schedules.push({callback:e,tickInterval:a,runScheduleId:null}),this}forEachPlayer(e,a=0){return this.forEachPlayers.push({callback:e,delay:a,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};var _a=ma.creative,vt=new C,Et=new G("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png",!0).setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});Et.runSchedule(()=>{let t=Et.getConfig(),e=Sa.getPlayers({gameMode:_a});for(let a of e){if(["moderator","admin","builder"].includes(d(a)))continue;try{t.setToSurvival&&a.runCommandAsync("gamemode s"),t.clearPlayer&&a.runCommandAsync("clear @s")}catch{}new l({playerName:a.name,protection:"Gamemode",message:`${a.name} has entered into a illegal gamemode!`});let r=(vt.get(a)??0)+1;vt.set(a,r),t.banPlayer&&r>=t.violationCount&&new y(a,null,"Illegal Gamemode")}},20);import{world as Wt}from"@minecraft/server";var Lt=new C,pa=15,ua=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area","plant"],ga=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],Rt=new C,yt,Gt=new G("nuker","Blocks block breaking too fast","textures/blocks/dirt.png",!0).setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});Gt.onEnable(()=>{let t=Gt.getConfig();yt=Wt.beforeEvents.playerBreakBlock.subscribe(e=>{if(["moderator","admin"].includes(d(e.player))||e.block.getTags().some(r=>ua.includes(r)))return;let a=Lt.get(e.player);if(Lt.set(e.player,Date.now()),!!a){if(!ga.includes(e.block.typeId)){if(a<Date.now()-pa)return;let r=(Rt.get(e.player)??0)+1;Rt.set(e.player,r),new l({message:`${e.player.name} has a updated nuker violation count of: ${r}.`,playerName:e.player.name}),t.banPlayer&&r>=t.violationCount&&new y(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{Wt.beforeEvents.playerBreakBlock.unsubscribe(yt)});var At=new C,Ft=new C,Ot=new G("spam","Blocks spam in chat","textures/ui/mute_on.png",!1).setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});Ot.subscribe("chatSend",t=>{try{if(t.message.startsWith(b)||["admin","moderator"].includes(d(t.sender)))return;let e=Ot.getConfig(),a=()=>{let r=(Ft.get(t.sender)??0)+1;Ft.set(t.sender,r),new l({message:`${t.sender.name} has a updated spam violation count of: ${r}.`,playerName:t.sender.name}),e.permMutePlayer&&r>=e.violationCount&&new D(t.sender,null,"Spamming")};if(e.repeatedMessages&&At.get(t.sender)==t.message)return t.cancel=!0,a(),new l({message:`${t.sender.name} has sent repeated messages.`,playerName:t.sender.name}),t.sender.sendMessage("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,a(),new l({message:`${t.sender.name} has sent zalgo messages.`,playerName:t.sender.name}),t.sender.sendMessage("\xA7cYou message contains some type of zalgo and cannot be sent!");At.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});var Ds=new re("db","object").setWorldDynamic(!0);ba.beforeEvents.watchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});var Se=[];function St(){Se=[]}export{Se as NPC_LOCATIONS,St as clearNpcLocations,Ds as database};
